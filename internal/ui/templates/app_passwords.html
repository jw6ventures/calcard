{{define "content"}}
<h1>App Passwords</h1>
<p>Generate tokens for DAV clients.</p>
{{if .PlainToken}}<p><strong>Copy this token now:</strong> {{.PlainToken}}</p>{{end}}
<table>
    <tr><th>Label</th><th>Created</th><th>Expires</th><th>Last Used</th><th>Status</th><th>Actions</th></tr>
    {{range .AppPasswords}}
    <tr>
        <td>{{.label}}</td>
        <td>{{formatTime .created_at}}</td>
        <td>{{if .expires_at}}{{formatTime .expires_at}}{{else}}none{{end}}</td>
        <td>{{if .last_used}}{{formatTime .last_used}}{{else}}never{{end}}</td>
        <td>{{.status}}</td>
        <td>
            {{if ne .status "revoked"}}
            <form method="post" action="/app-passwords/{{.id}}" style="display:inline" onsubmit="return confirm('Revoke token?')">
                <input type="hidden" name="_csrf" value="{{$.CSRFToken}}">
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit">Revoke</button>
            </form>
            {{else}}-
            {{end}}
        </td>
    </tr>
    {{else}}
    <tr><td colspan="6">No tokens issued yet.</td></tr>
    {{end}}
</table>
<form method="post" action="/app-passwords" class="app-password-form">
    <h3>Create new token</h3>
    <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
    <div class="form-row">
        <label>Label <input name="label" required placeholder="e.g., Thunderbird"></label>
    </div>
    <div class="form-row">
        <label>Expires At (optional) <input type="datetime-local" name="expires_at" id="expires_at"></label>
    </div>
    <button type="submit">Generate</button>
</form>
<style>
    .app-password-form {
        max-width: 400px;
        margin-top: 2rem;
    }
    .app-password-form .form-row {
        margin-bottom: 1rem;
    }
    .app-password-form label {
        display: block;
        margin-bottom: 0.25rem;
        font-weight: 500;
    }
    .app-password-form input[type="text"],
    .app-password-form input[type="datetime-local"] {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        font-size: 0.875rem;
    }
    .app-password-form input[name="label"] {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
    }
</style>
<script>
// Set min date to now
document.getElementById('expires_at').min = new Date().toISOString().slice(0, 16);
</script>
{{end}}
{{template "base" .}}
