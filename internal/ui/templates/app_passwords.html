{{define "content"}}
<style>
    .page-header {
        margin-bottom: 2rem;
    }

    .page-header p {
        color: var(--gray-600);
        margin-top: 0.5rem;
    }

    .token-alert {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: #fff;
        padding: 1.5rem;
        border-radius: var(--border-radius-lg);
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
    }

    .token-alert h3 {
        margin: 0 0 0.75rem 0;
        color: #fff;
        font-size: 1rem;
    }

    .token-value {
        background: rgba(255, 255, 255, 0.2);
        padding: 1rem;
        border-radius: var(--border-radius);
        font-family: 'Courier New', monospace;
        font-size: 1rem;
        word-break: break-all;
        border: 1px solid rgba(255, 255, 255, 0.3);
        margin-bottom: 0.75rem;
    }

    .token-warning {
        font-size: 0.875rem;
        opacity: 0.95;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .passwords-table-wrapper {
        background: var(--bg-secondary);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        overflow: hidden;
        margin-bottom: 2rem;
    }

    .status-badge {
        padding: 0.25rem 0.625rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: capitalize;
    }

    .status-badge.active {
        background: #d1fae5;
        color: #065f46;
    }

    .status-badge.revoked {
        background: #fee2e2;
        color: #991b1b;
    }

    .create-password-card {
        background: var(--bg-secondary);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        padding: 2rem;
    }

    .create-password-card h3 {
        margin-bottom: 1.5rem;
    }

    .form-grid {
        display: grid;
        gap: 1.25rem;
        margin-bottom: 1.5rem;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .form-group label {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 0.9rem;
    }

    .form-help {
        font-size: 0.8rem;
        color: var(--gray-500);
        margin-top: 0.25rem;
    }

    .empty-state {
        background: var(--bg-secondary);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        padding: 3rem;
        text-align: center;
    }

    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        color: var(--gray-600);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--gray-500);
    }

    td form {
        display: inline;
    }
</style>

<div class="page-header">
    <h1>üîë App Passwords</h1>
    <p>Generate authentication tokens for CalDAV and CardDAV clients</p>
</div>

{{if .PlainToken}}
<div class="token-alert">
    <h3>‚ö†Ô∏è Your New Token</h3>
    <div class="token-value">{{.PlainToken}}</div>
    <div class="token-warning">
        üîí Copy this token now! It won't be shown again for security reasons.
    </div>
</div>
{{end}}

{{if .AppPasswords}}
<div class="passwords-table-wrapper">
    <table>
        <thead>
            <tr>
                <th>Label</th>
                <th>Created</th>
                <th>Expires</th>
                <th>Last Used</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .AppPasswords}}
            <tr>
                <td><strong>{{.label}}</strong></td>
                <td>{{formatTime .created_at}}</td>
                <td>{{if .expires_at}}{{formatTime .expires_at}}{{else}}<span style="color: var(--gray-500);">Never</span>{{end}}</td>
                <td>{{if .last_used}}{{formatTime .last_used}}{{else}}<span style="color: var(--gray-500);">Never</span>{{end}}</td>
                <td>
                    <span class="status-badge {{.status}}">{{.status}}</span>
                </td>
                <td>
                    {{if ne .status "revoked"}}
                    <form method="post" action="/app-passwords/{{.id}}" onsubmit="return confirm('Are you sure you want to revoke this token?')">
                        <input type="hidden" name="_csrf" value="{{$.CSRFToken}}">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="submit" class="btn-sm btn-danger">Revoke</button>
                    </form>
                    {{else}}
                    <form method="post" action="/app-passwords/{{.id}}/delete" onsubmit="return confirm('Delete this revoked token? This cannot be undone.')">
                        <input type="hidden" name="_csrf" value="{{$.CSRFToken}}">
                        <button type="submit" class="btn-sm btn-danger">Delete</button>
                    </form>
                    {{end}}
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{else}}
<div class="empty-state">
    <div class="empty-state-icon">üîë</div>
    <h3>No tokens yet</h3>
    <p>Create an app password to connect your CalDAV/CardDAV clients</p>
</div>
{{end}}

<div class="create-password-card">
    <h3>‚ûï Generate New Token</h3>
    <form method="post" action="/app-passwords">
        <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
        <div class="form-grid">
            <div class="form-group">
                <label for="label">Label</label>
                <input type="text" id="label" name="label" required placeholder="e.g., Thunderbird, iPhone, Outlook">
                <div class="form-help">A descriptive name to identify this token</div>
            </div>
            <div class="form-group">
                <label for="expires_at">Expiration Date (Optional)</label>
                <input type="datetime-local" id="expires_at" name="expires_at">
                <div class="form-help">Leave blank for no expiration</div>
            </div>
        </div>
        <button type="submit" class="btn-primary">üîë Generate Token</button>
    </form>
</div>

<script>
// Set min date to now
document.getElementById('expires_at').min = new Date().toISOString().slice(0, 16);
</script>
{{end}}
{{template "base" .}}
